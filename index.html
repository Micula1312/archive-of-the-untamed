<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Archive of the Untamed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Shared terminal theme -->
  <link rel="stylesheet" href="css/terminal.css" />
  <style>
    /* Page-specific tiny tweaks */
    #terminal { white-space: pre-wrap; line-height: 1.3; }
    #controls { display:flex; gap:8px; margin:12px 0; }
    #controls button { border:1px solid var(--term-border); background:var(--term-ui-bg); color:var(--term-fg); padding:6px 10px; font-family:inherit; }
    a.node { color: var(--term-fg); text-decoration: underline; }
  </style>
</head>
<body>
  <header class="container">
    <h1>ARCHIVE OF THE UNTAMED</h1>
    <div class="toggle">
      <span>theme</span>
      <button id="themeBtn" aria-pressed="false">terminal</button>
    </div>
    <p class="sub">protocol://disorder.memory.network</p>
  </header>

  <main class="container">
    <div id="terminal"></div>

    <div id="controls">
      <button id="themeToggleBtn" type="button">[ toggle dark/light ]</button>
      <button id="audioBtn" type="button">[ unmute ]</button>
    </div>

    <audio id="bg-audio" preload="auto" playsinline loop muted>
      <source src="audio/soundscape.mp3" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
  </main>

  <script>
    // ================= THEME (same logic as archive)
    const THEME_KEY = 'aotuTheme';
    const themeBtn = document.getElementById('themeBtn');
    const themeToggleBtn = document.getElementById('themeToggleBtn');

    function applyTheme(t) {
      document.body.classList.toggle('light', t === 'light');
      if (themeBtn) {
        themeBtn.setAttribute('aria-pressed', String(t === 'light'));
        themeBtn.textContent = t === 'light' ? 'light' : 'terminal';
      }
    }
    function flipTheme() {
      const cur = document.body.classList.contains('light') ? 'light' : 'terminal';
      const next = cur === 'light' ? 'terminal' : 'light';
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    }
    applyTheme(localStorage.getItem(THEME_KEY) || 'terminal');
    if (themeBtn) themeBtn.addEventListener('click', flipTheme);
    if (themeToggleBtn) themeToggleBtn.addEventListener('click', flipTheme);

    // ================= TYPEWRITER
    const terminalText = `
:: protocol://disorder.memory.network/init
:: version 3.0

> STATUS: ACTIVE [OK]
> AUTHOR: Micol Gelsi
> CURRENT_LOCATION: Rome (IT)

> ACCESSING SYSTEM...

> ABOUT:
  Archive of the Untamed is an artistic research project exploring
  urban wildness, collective memory, and performative archiving
  as tools of resistance and reappropriation.

> PLATFORM NODES:
  - Abstract                 -> abstract.html
  - Manifesto                -> manifesto.html
  - Online Platform          -> archive.html
  - Hardware Treehouse       -> #hardware
  - Performative Logs        -> #logs
  - Narrative Modes          -> #narratives
  - Editorial Dump           -> #dump

> REPOSITORY: /archive-of-the-untamed/

> END_OF_INDEX â–ˆ`;

    const terminal = document.getElementById('terminal');
    let idx = 0;
    (function typeWriter() {
      if (idx < terminalText.length) {
        terminal.textContent += terminalText.charAt(idx++);
        setTimeout(typeWriter, 10);
      } else {
        // After typing finishes, convert node lines into links
        linkifyNodes();
      }
    })();

    function linkifyNodes() {
      // Replace the "-> url" markers with real anchors
      const map = {
        'abstract.html': 'abstract.html',
        'manifesto.html': 'manifesto.html',
        'archive.html': 'archive.html',
        '#hardware': '#hardware',
        '#logs': '#logs',
        '#narratives': '#narratives',
        '#dump': '#dump'
      };
      let html = terminal.innerHTML
        .replace(/-&nbsp;Abstract\\s*->\\s*abstract\\.html/g, '- <a class="node" href="abstract.html">Abstract</a>')
        .replace(/-&nbsp;Manifesto\\s*->\\s*manifesto\\.html/g, '- <a class="node" href="manifesto.html">Manifesto</a>')
        .replace(/-&nbsp;Online Platform\\s*->\\s*archive\\.html/g, '- <a class="node" href="archive.html">Online Platform</a>')
        .replace(/-&nbsp;Hardware Treehouse\\s*->\\s*#hardware/g, '- <a class="node" href="#hardware">Hardware Treehouse</a>')
        .replace(/-&nbsp;Performative Logs\\s*->\\s*#logs/g, '- <a class="node" href="#logs">Performative Logs</a>')
        .replace(/-&nbsp;Narrative Modes\\s*->\\s*#narratives/g, '- <a class="node" href="#narratives">Narrative Modes</a>')
        .replace(/-&nbsp;Editorial Dump\\s*->\\s*#dump/g, '- <a class="node" href="#dump">Editorial Dump</a>');
      // In case the browser didn't convert spaces to &nbsp; in innerHTML, do a second pass with normal spaces:
      html = html
        .replace(/- Abstract\\s*->\\s*abstract\\.html/g, '- <a class="node" href="abstract.html">Abstract</a>')
        .replace(/- Manifesto\\s*->\\s*manifesto\\.html/g, '- <a class="node" href="manifesto.html">Manifesto</a>')
        .replace(/- Online Platform\\s*->\\s*archive\\.html/g, '- <a class="node" href="archive.html">Online Platform</a>')
        .replace(/- Hardware Treehouse\\s*->\\s*#hardware/g, '- <a class="node" href="#hardware">Hardware Treehouse</a>')
        .replace(/- Performative Logs\\s*->\\s*#logs/g, '- <a class="node" href="#logs">Performative Logs</a>')
        .replace(/- Narrative Modes\\s*->\\s*#narratives/g, '- <a class="node" href="#narratives">Narrative Modes</a>')
        .replace(/- Editorial Dump\\s*->\\s*#dump/g, '- <a class="node" href="#dump">Editorial Dump</a>');
      terminal.innerHTML = html;
    }

    // ================= AUDIO
    const audio = document.getElementById('bg-audio');
    const audioBtn = document.getElementById('audioBtn');

    function updateAudioBtnLabel() {
      audioBtn.textContent = audio.muted ? '[ unmute ]' : '[ mute ]';
    }
    function toggleAudio() {
      // try to play if previously blocked
      if (audio.paused && audio.muted === false) {
        audio.play().catch(() => {});
      }
      audio.muted = !audio.muted;
      if (!audio.muted) {
        audio.play().catch(() => {}); // re-attempt play after unmute
      }
      updateAudioBtnLabel();
    }
    audioBtn.addEventListener('click', toggleAudio);
    updateAudioBtnLabel();
  </script>
</body>
</html>
